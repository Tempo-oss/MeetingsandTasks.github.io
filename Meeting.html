<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MeetingMate - Collaborative Meeting Tool</title>
    
    <!-- Robust Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ“…</text></svg>">

    <!-- Global Error Handler -->
    <script>
        window.onerror = function(msg, url, line, col, error) {
            const root = document.getElementById('root');
            if (root) {
                root.innerHTML = `
                    <div style="background-color: #FEF2F2; color: #991B1B; padding: 2rem; font-family: sans-serif; height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center;">
                        <h2 style="font-size: 1.5rem; font-weight: bold; margin-bottom: 0.5rem;">Startup Error</h2>
                        <div style="background: #fff; padding: 1rem; border-radius: 0.5rem; border: 1px solid #FCA5A5; text-align: left; max-width: 600px; overflow-x: auto;">
                            <code style="font-family: monospace;">${msg}</code>
                        </div>
                    </div>
                `;
            }
        };
    </script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Supabase JS Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        body { font-family: 'Inter', sans-serif; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .prose h1 { font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem; color: #111827; }
        .prose p { margin-bottom: 0.75rem; line-height: 1.6; color: #374151; }
        .prose:focus { outline: none; }
    </style>
</head>
<body class="bg-gray-50 text-gray-900 h-screen overflow-hidden">
    <!-- Initial Loading State -->
    <div id="root" class="h-full flex items-center justify-center">
        <div class="text-center text-gray-500 animate-pulse">
            <p>Loading MeetingMate...</p>
        </div>
    </div>

    <script type="text/babel">
        // Dependency Check
        if (!window.React || !window.ReactDOM || !window.supabase) {
            throw new Error("Missing dependencies. Check internet connection.");
        }

        const { useState, useEffect, useRef } = React;

        // --- Configuration ---
        const SUPABASE_URL = 'https://yasoowbpyknuikdvlahz.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_7upkUKZm8t5fQh9EwLVFbQ_DmnLAObn';
        
        let supabase;
        try {
            supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        } catch (e) {
            console.error("Supabase Init Error:", e);
            throw new Error("Failed to initialize Supabase client.");
        }

        // --- Icons ---
        const Icon = ({ name, className, ...props }) => {
            const icons = {
                Calendar: <path d="M19 4H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2Zm-13 0V2m12 2V2M3 10h18" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>,
                Clock: <path d="M12 22a10 10 0 1 0 0-20 10 10 0 0 0 0 20Zm0-14v6l4 2" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>,
                Video: <path d="m22 8-6 4 6 4V8Z M16 19h-4m-4 0H4a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2Z" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>,
                Users: <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2 M9 7a4 4 0 1 0 0-8 4 4 0 0 0 0 8Z M22 21v-2a4 4 0 0 0-3-3.87 M16 3.13a4 4 0 0 1 0 7.75" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>,
                Search: <path d="m21 21-4.3-4.3 M11 19a8 8 0 1 0 0-16 8 8 0 0 0 0 16Z" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>,
                Plus: <path d="M12 5v14M5 12h14" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>,
                ChevronLeft: <path d="m15 18-6-6 6-6" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>,
                RefreshCw: <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8 M21 3v5h-5 M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16 M3 21v-5h5" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>,
                Database: <path d="M3 5V19A9 3 0 0 0 21 19V5 M3 5A9 3 0 0 1 21 5 M3 5A9 3 0 0 0 21 5 M3 12A9 3 0 0 0 21 12" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>,
                UploadCloud: <path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242 M12 12v9 M16 16l-4-4-4 4" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>,
                AlertCircle: <path d="M12 22a10 10 0 1 0 0-20 10 10 0 0 0 0 20Zm-1-9h2m-2 4h2" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>,
                CheckSquare: <path d="m9 11 3 3L22 4 M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>,
                FileText: <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z M14 2v6h6" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>,
                Bold: <path d="M14 12a4 4 0 0 0 0-8H6v8 M15 20a4 4 0 0 0 0-8H6v8Z" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>,
                Italic: <path d="M19 4h-9M14 20H5M15 4L9 20" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>,
                Underline: <path d="M6 4v6a6 6 0 0 0 12 0V4 M4 20h16" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>,
                Share2: <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8 M16 6l-4-4-4 4 M12 2v13" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>,
                Circle: <path d="M12 22a10 10 0 1 0 0-20 10 10 0 0 0 0 20Z" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>,
                CheckCircle2: <path d="M12 22a10 10 0 1 0 0-20 10 10 0 0 0 0 20Zm-1-9 2 2 4-4" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>,
                Link: <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71 M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>,
                X: <path d="M18 6 6 18M6 6l12 12" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>,
                LogOut: <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4 M16 17l5-5-5-5 M21 12H9" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>,
                Google: <><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/><path d="M24 12c0-.82-.07-1.63-.2-2.43H12v4.6h6.77c-.29 1.55-1.16 2.87-2.48 3.75l.02-.02 3.55 2.75c2.08-1.91 3.28-4.73 3.28-8.22z" fill="#4285F4"/></>
            };
            return (
                <svg 
                    xmlns="http://www.w3.org/2000/svg" 
                    width="24" height="24" 
                    viewBox="0 0 24 24" 
                    fill="none" 
                    className={className}
                    {...props}
                >
                    {icons[name] || <circle cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="2"/>}
                </svg>
            );
        };

        const SQL_SETUP_INSTRUCTIONS = `
        -- Run these commands in your Supabase SQL Editor to enable full persistence:
        
        create table meetings (
            id text primary key,
            title text,
            date text,
            time text,
            duration text,
            participants jsonb, 
            doc_id text,
            google_calendar_id text,
            synced boolean,
            platform text
        );

        create table tasks (
            id text primary key,
            meeting_id text,
            text text,
            assignee text,
            done boolean
        );

        create table docs (
            id text primary key,
            content text
        );
        `;

        // --- Mock Users for Demo Mode ---
        const DEMO_USERS = [
            { id: 'u1', name: 'Alice Chen', role: 'Product Manager', avatar: 'AC', color: 'bg-blue-500' },
            { id: 'u2', name: 'Bob Smith', role: 'Developer', avatar: 'BS', color: 'bg-green-500' },
            { id: 'u3', name: 'Charlie Kim', role: 'Designer', avatar: 'CK', color: 'bg-purple-500' },
            { id: 'u4', name: 'Dana Lee', role: 'VP Engineering', avatar: 'DL', color: 'bg-orange-500' },
        ];

        const SEED_MEETINGS = [
            { id: 'm1', title: 'Q3 Product Roadmap', date: '2023-10-25', time: '10:00 AM', duration: '1h', participants: ['u1', 'u2', 'u3', 'u4'], docId: 'd1', synced: true, platform: 'Google Meet' },
            { id: 'm2', title: 'Design Huddle', date: '2023-10-25', time: '02:00 PM', duration: '45m', participants: ['u1', 'u3'], docId: 'd2', synced: true, platform: 'Zoom' },
            { id: 'm3', title: 'Weekly Engineering', date: '2023-10-26', time: '11:00 AM', duration: '1h', participants: ['u2', 'u4'], docId: 'd3', synced: true, platform: 'Google Meet' }
        ];

        const SEED_TASKS = [
            { id: 't1', meetingId: 'm1', text: 'Finalize Q3 scope', assignee: 'u1', done: false },
            { id: 't2', meetingId: 'm1', text: 'Update Jira', assignee: 'u2', done: true },
        ];

        const SEED_DOCS = {
            'd1': "<h1>Q3 Roadmap</h1><p>Goals for the quarter...</p>",
            'd2': "<h1>Design Notes</h1><p>Accessibility standards...</p>",
            'd3': "<h1>Eng Sync</h1><p>Migration plan...</p>"
        };

        // --- Components ---

        const UserAvatar = ({ user, size = 'md' }) => {
            const sizeClasses = { sm: 'w-6 h-6 text-xs', md: 'w-8 h-8 text-sm', lg: 'w-10 h-10 text-base' };
            if (!user) return null;
            return (
                <div className={`${sizeClasses[size]} ${user.color || 'bg-indigo-600'} rounded-full flex items-center justify-center text-white font-medium ring-2 ring-white select-none uppercase`} title={user.name}>
                    {user.avatar || user.name.substring(0,2)}
                </div>
            );
        };

        const MeetingCard = ({ meeting, users, onClick }) => {
            const participantIds = Array.isArray(meeting.participants) ? meeting.participants : [];
            const attendees = participantIds.map(id => users.find(u => u.id === id) || {id, name: 'Guest', avatar: 'G', color: 'bg-gray-400'}).slice(0, 4);
            
            return (
                <div onClick={onClick} className="bg-white rounded-xl border border-gray-200 p-5 hover:shadow-lg hover:border-indigo-200 transition-all cursor-pointer group">
                    <div className="flex justify-between items-start mb-3">
                        <div>
                            <h3 className="font-semibold text-gray-900 group-hover:text-indigo-600 transition-colors">{meeting.title}</h3>
                            <div className="flex items-center text-gray-500 text-sm mt-1 space-x-3">
                                <span className="flex items-center"><Icon name="Clock" className="w-3 h-3 mr-1" /> {meeting.time}</span>
                                <span className="flex items-center"><Icon name="Video" className="w-3 h-3 mr-1" /> {meeting.platform}</span>
                            </div>
                        </div>
                        {meeting.synced && <div className="bg-blue-50 text-blue-600 p-1.5 rounded-full"><Icon name="Calendar" className="w-4 h-4" /></div>}
                    </div>
                    <div className="flex justify-between items-center mt-4">
                        <div className="flex -space-x-2">
                            {attendees.map((user, i) => <UserAvatar key={i} user={user} size="sm" />)}
                        </div>
                        <div className="flex items-center text-gray-400 text-sm space-x-1 group-hover:text-indigo-500 transition-colors">
                            <span>Open Notes</span>
                            <Icon name="ChevronLeft" className="w-4 h-4 rotate-180" />
                        </div>
                    </div>
                </div>
            );
        };

        const GoogleDocEditor = ({ docContent, title, onSave }) => {
            const [localContent, setLocalContent] = useState(docContent);
            const timeoutRef = useRef(null);
            useEffect(() => { setLocalContent(docContent || '<p class="text-gray-400 italic">Start typing...</p>'); }, [docContent]);
            const handleChange = (e) => {
                const newContent = e.currentTarget.innerHTML;
                if (timeoutRef.current) clearTimeout(timeoutRef.current);
                timeoutRef.current = setTimeout(() => { onSave(newContent); }, 1000);
            };
            return (
                <div className="flex flex-col h-full bg-gray-100 rounded-lg overflow-hidden border border-gray-300">
                    <div className="bg-white border-b border-gray-200 p-2 flex items-center justify-between">
                        <div className="flex items-center space-x-4">
                            <div className="bg-blue-600 p-1.5 rounded text-white"><Icon name="FileText" className="w-5 h-5" /></div>
                            <h3 className="text-sm font-medium text-gray-800 leading-tight truncate max-w-[200px]">{title}</h3>
                        </div>
                    </div>
                    <div className="flex-1 overflow-y-auto p-8 flex justify-center">
                        <div className="bg-white w-full max-w-3xl shadow-sm min-h-full p-12 outline-none">
                            <div className="prose max-w-none focus:outline-none" contentEditable suppressContentEditableWarning dangerouslySetInnerHTML={{ __html: localContent }} onInput={handleChange} />
                        </div>
                    </div>
                </div>
            );
        };

        const LoginScreen = ({ onLogin, onDemo }) => (
            <div className="h-full flex items-center justify-center bg-gray-50 p-4">
                <div className="bg-white p-8 rounded-2xl shadow-xl max-w-md w-full text-center">
                    <div className="bg-indigo-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-6">
                        <Icon name="Calendar" className="w-8 h-8 text-indigo-600" />
                    </div>
                    <h1 className="text-2xl font-bold text-gray-900 mb-2">Welcome to MeetingMate</h1>
                    <p className="text-gray-500 mb-8">Collaborate on meeting notes, track tasks, and sync with your team.</p>
                    
                    <button onClick={onLogin} className="w-full flex items-center justify-center space-x-3 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 font-medium py-3 px-4 rounded-lg transition-colors mb-4">
                        <Icon name="Google" className="w-5 h-5" />
                        <span>Sign in with Google</span>
                    </button>
                    
                    <div className="relative my-6">
                        <div className="absolute inset-0 flex items-center"><div className="w-full border-t border-gray-200"></div></div>
                        <div className="relative flex justify-center text-sm"><span className="px-2 bg-white text-gray-500">Or try without account</span></div>
                    </div>

                    <button onClick={onDemo} className="w-full text-indigo-600 font-medium text-sm hover:underline">
                        Enter Demo Mode
                    </button>

                     <p className="text-xs text-gray-400 mt-6">
                        Note: To use Google Auth, you must enable the Google Provider in your Supabase Dashboard.
                    </p>
                </div>
            </div>
        );

        const App = () => {
            const [session, setSession] = useState(null);
            const [isDemo, setIsDemo] = useState(false);
            const [currentUser, setCurrentUser] = useState(null);
            const [view, setView] = useState('dashboard');
            const [selectedMeetingId, setSelectedMeetingId] = useState(null);
            const [meetings, setMeetings] = useState([]);
            const [tasks, setTasks] = useState([]);
            const [docs, setDocs] = useState({});
            const [dbStatus, setDbStatus] = useState('connecting'); 
            const [errorMsg, setErrorMsg] = useState('');
            const [loading, setLoading] = useState(true);

            // Auth Check
            useEffect(() => {
                supabase.auth.getSession().then(({ data: { session } }) => {
                    setSession(session);
                    if (session) {
                        setCurrentUser({
                            id: session.user.id,
                            name: session.user.user_metadata.full_name || session.user.email,
                            role: 'Owner',
                            avatar: (session.user.user_metadata.full_name || 'U').substring(0, 2).toUpperCase(),
                            color: 'bg-indigo-600'
                        });
                        setLoading(false);
                        fetchData();
                    } else {
                        setLoading(false);
                    }
                });

                const { data: { subscription } } = supabase.auth.onAuthStateChange((_event, session) => {
                    setSession(session);
                    if (session) {
                         setCurrentUser({
                            id: session.user.id,
                            name: session.user.user_metadata.full_name || session.user.email,
                            role: 'Owner',
                            avatar: (session.user.user_metadata.full_name || 'U').substring(0, 2).toUpperCase(),
                            color: 'bg-indigo-600'
                        });
                        fetchData();
                    }
                });

                return () => subscription.unsubscribe();
            }, []);

            const handleGoogleLogin = async () => {
                const { error } = await supabase.auth.signInWithOAuth({ provider: 'google', options: { redirectTo: window.location.href } });
                if (error) alert(error.message);
            };

            const handleLogout = async () => {
                await supabase.auth.signOut();
                setSession(null);
                setCurrentUser(null);
                setIsDemo(false);
            };

            const enterDemo = () => {
                setIsDemo(true);
                setCurrentUser(DEMO_USERS[0]);
                fetchData(); // Will likely fail tables check but fall back to mock
            };

            const fetchData = async () => {
                setDbStatus('connecting');
                try {
                    // Check connection
                    const { error: checkError } = await supabase.from('meetings').select('id').limit(1);
                    if (checkError && (checkError.code === 'PGRST205' || checkError.code === '42P01')) {
                        throw { code: 'TABLE_MISSING' };
                    }

                    const { data: m, error: mErr } = await supabase.from('meetings').select('*');
                    const { data: t, error: tErr } = await supabase.from('tasks').select('*');
                    const { data: d, error: dErr } = await supabase.from('docs').select('*');

                    if (mErr || tErr || dErr) throw new Error("Fetch failed");

                    // Parse
                    const parsedM = m.map(x => ({ ...x, participants: typeof x.participants === 'string' ? JSON.parse(x.participants) : x.participants || [] }));
                    const parsedT = t.map(x => ({ ...x, meetingId: x.meeting_id })); // map casing
                    const docsMap = {}; d.forEach(x => docsMap[x.id] = x.content);

                    setMeetings(parsedM);
                    setTasks(parsedT);
                    setDocs(docsMap);
                    setDbStatus(parsedM.length ? 'connected' : 'empty');

                } catch (err) {
                    if (err.code === 'TABLE_MISSING') {
                        setDbStatus('setup_required');
                    } else {
                        console.error(err);
                        setDbStatus('error');
                        setErrorMsg(err.message);
                    }
                }
            };

            const seedDatabase = async () => {
                if (dbStatus === 'setup_required') return alert("Please setup tables first (see error box).");
                try {
                    // Update seed data to include CURRENT USER if logged in
                    const seedMeetings = SEED_MEETINGS.map(m => {
                        if (currentUser && !isDemo) {
                            // Add current user to participants of first meeting
                            if (m.id === 'm1') return { ...m, participants: [...m.participants, currentUser.id] };
                        }
                        return m;
                    });

                    for (const m of seedMeetings) await supabase.from('meetings').upsert({ id: m.id, title: m.title, date: m.date, time: m.time, duration: m.duration, participants: m.participants, doc_id: m.docId, google_calendar_id: m.googleCalendarId, synced: m.synced, platform: m.platform });
                    for (const t of SEED_TASKS) await supabase.from('tasks').upsert({ id: t.id, meeting_id: t.meetingId, text: t.text, assignee: t.assignee, done: t.done });
                    for (const d of Object.entries(SEED_DOCS)) await supabase.from('docs').upsert({ id: d[0], content: d[1] });
                    
                    fetchData();
                } catch (e) { alert("Seed failed: " + e.message); }
            };

            const handleDocSave = async (content) => {
                if(!selectedMeetingId) return;
                const m = meetings.find(x => x.id === selectedMeetingId);
                setDocs(prev => ({ ...prev, [m.docId]: content }));
                if (dbStatus === 'connected' || dbStatus === 'empty') {
                    await supabase.from('docs').upsert({ id: m.docId, content });
                }
            };

            // Filter Logic
            const myMeetings = meetings.filter(m => {
                if (!currentUser) return false;
                if (isDemo && !DEMO_USERS.find(u => u.id === currentUser.id)) return true; // Show all for generic demo
                return m.participants && Array.isArray(m.participants) && m.participants.includes(currentUser.id);
            });

            if (loading) return null; // Initial spinner in HTML handles this

            if (!session && !isDemo) return <LoginScreen onLogin={handleGoogleLogin} onDemo={enterDemo} />;

            // --- Dashboard View ---
            if (view === 'dashboard') {
                return (
                    <div className="flex flex-col h-screen bg-gray-50">
                        <header className="bg-white border-b h-16 flex items-center justify-between px-6">
                            <div className="flex items-center space-x-3">
                                <Icon name="Calendar" className="text-indigo-600 w-6 h-6" />
                                <h1 className="font-bold text-gray-800">SyncMeet</h1>
                                {dbStatus === 'connected' && <span className="bg-green-100 text-green-700 text-xs px-2 py-0.5 rounded-full">Connected</span>}
                                {dbStatus === 'setup_required' && <span className="bg-red-100 text-red-700 text-xs px-2 py-0.5 rounded-full">DB Setup Needed</span>}
                            </div>
                            <div className="flex items-center space-x-4">
                                {(dbStatus === 'empty' || dbStatus === 'connected') && <button onClick={seedDatabase} className="text-sm font-medium text-indigo-600 hover:underline">Seed DB</button>}
                                <div className="flex items-center space-x-2">
                                    <UserAvatar user={currentUser} />
                                    <span className="text-sm font-medium hidden sm:inline">{currentUser.name}</span>
                                    <button onClick={handleLogout} className="text-gray-400 hover:text-red-600 ml-2"><Icon name="LogOut" className="w-5 h-5" /></button>
                                </div>
                            </div>
                        </header>

                        <main className="flex-1 overflow-y-auto p-6">
                            <div className="max-w-5xl mx-auto">
                                <h2 className="text-2xl font-bold mb-6">Upcoming Meetings</h2>
                                
                                {dbStatus === 'setup_required' && (
                                    <div className="bg-red-50 border border-red-200 p-6 rounded-lg mb-6">
                                        <h3 className="font-bold text-red-900 mb-2">Database Missing Tables</h3>
                                        <p className="text-sm text-red-700 mb-4">Run this SQL in your Supabase Dashboard:</p>
                                        <div className="bg-gray-900 text-gray-100 p-3 rounded text-xs overflow-auto max-h-32 mb-4"><pre>{SQL_SETUP_INSTRUCTIONS}</pre></div>
                                        <button onClick={fetchData} className="bg-red-600 text-white px-4 py-2 rounded text-sm">Retry Connection</button>
                                    </div>
                                )}

                                {myMeetings.length > 0 ? (
                                    <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                                        {myMeetings.map(m => <MeetingCard key={m.id} meeting={m} users={isDemo ? DEMO_USERS : (currentUser ? [currentUser, ...DEMO_USERS] : DEMO_USERS)} onClick={() => { setSelectedMeetingId(m.id); setView('meeting'); }} />)}
                                    </div>
                                ) : (
                                    <div className="text-center py-20 bg-white rounded-xl border border-dashed">
                                        <p className="text-gray-500">No meetings found for you.</p>
                                        {dbStatus === 'empty' && <p className="text-sm text-indigo-500 mt-2">Click "Seed DB" above.</p>}
                                    </div>
                                )}
                            </div>
                        </main>
                    </div>
                );
            }

            // --- Meeting View ---
            const m = meetings.find(x => x.id === selectedMeetingId);
            if (!m) return null;

            return (
                <div className="flex flex-col h-screen bg-white">
                    <header className="border-b p-4 flex justify-between items-center">
                        <div className="flex items-center space-x-4">
                            <button onClick={() => setView('dashboard')} className="p-2 hover:bg-gray-100 rounded-full"><Icon name="ChevronLeft" className="w-5 h-5" /></button>
                            <h2 className="font-bold">{m.title}</h2>
                        </div>
                    </header>
                    <div className="flex-1 flex overflow-hidden">
                        <div className="flex-1 p-4 bg-gray-100">
                            <GoogleDocEditor title={m.title} docContent={docs[m.docId]} onSave={handleDocSave} />
                        </div>
                        <div className="w-80 border-l bg-white p-4">
                            <h3 className="font-bold mb-4">Tasks</h3>
                            <div className="space-y-2">
                                {tasks.filter(t => t.meetingId === m.id).map(t => (
                                    <div key={t.id} className="flex items-center space-x-2 p-2 border rounded">
                                        <div className={`w-4 h-4 rounded-full border ${t.done ? 'bg-green-500 border-green-500' : 'border-gray-300'}`}></div>
                                        <span className={t.done ? 'line-through text-gray-400' : ''}>{t.text}</span>
                                    </div>
                                ))}
                                {tasks.filter(t => t.meetingId === m.id).length === 0 && <p className="text-gray-400 text-sm italic">No tasks yet.</p>}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
